<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>jruby on rails and legacy java apps managing dependencies | Leonardo Borges</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="
The motivation for this post came from a couple of messages I&#39;ve seen on the jruby&#39;s google group and because I think it&#39;s pretty cool to share how we tackled this problem.- A little bit of contextWe, as a vast amount of people out there, have legacy Java code. A lot. In our case this legacy is pretty much crucial to our business. We can&#39;t just trash it and start from scratch. Bad idea.On the other hand we do have new features to be built on top of it. But we wanted an easier way to develop this new stuff and decided for a JRuby on Rails solution, using it as a front-end to our existing services.- What we decided to doOur final rails project would make use of a specially created jar file containing our Java application. This Jar would also contain a public interface of the services we&#39;d have to interact with from rails.As any Java application, ours depend on a number of external jar files that correspond to the various framewoks we usually have in place. e.g.: Hibernate, Spring, apache-commons ...Which means we need to make our app&#39;s jar and all it&#39;s dependencies available in the JRuby classpath in order to use it.Given we&#39;re using warbler to package our application as a war file, we just need to place all jars needed into our rails app&#39;s lib folder. Warbler then takes care of copying any jar files located in there into the war.- The problemSo we needed a smart way to include all these dependencies into the project, and copy/paste isn&#39;t an option.In the Java world we use Maven to manage our projects dependencies - and you should too. Because of that our approach involved turning our rails application into a Maven aware project.Basically we needed a pom file that would declaratively list our java project as a dependency. From there on, Maven knows what the dependencies are and downloads them to your local repository.Which leaves us with one more task. We need to put all these dependencies into our lib folder after maven has downloaded them.Below you&#39;ll find the pom.xml file that we use to achieve this with inline comments explaining each bit:
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
  xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.company&lt;/groupId&gt;
  &lt;!-- notice how we specify the packaging to be a war,
          that way, maven knows where to copy the jar files --&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;artifactId&gt;railsApp&lt;/artifactId&gt;
  &lt;name&gt;railsApp&lt;/name&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.company&lt;/groupId&gt;
            &lt;artifactId&gt;java-legacy-app&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;finalName&gt;railsApp&lt;/finalName&gt;
        &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;!-- This tasks only creates a basic structure expected by maven,
                    so it can do its work --&gt;
            &lt;id&gt;create-mock-web-descriptor&lt;/id&gt;
            &lt;phase&gt;compile&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;executable&gt;/bin/sh&lt;/executable&gt;
              &lt;workingDirectory&gt;.&lt;/workingDirectory&gt;
              &lt;arguments&gt;
                &lt;argument&gt;-c&lt;/argument&gt;
                &lt;argument&gt;
                    mkdir -p src/main/webapp/WEB-INF
                    touch    src/main/webapp/WEB-INF/web.xml
                &lt;/argument&gt;
              &lt;/arguments&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;exec&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;!-- Now in the package phase we copy the jar files
                    that maven put into the fake web app to our rails&#39; lib folder --&gt;
            &lt;id&gt;copy-needed-jars-into-lib&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;executable&gt;/bin/sh&lt;/executable&gt;
              &lt;workingDirectory&gt;.&lt;/workingDirectory&gt;
              &lt;arguments&gt;
                &lt;argument&gt;-c&lt;/argument&gt;
                &lt;argument&gt;
                    rm -f lib/*.jar
                    cp target/railsApp/WEB-INF/lib/*.jar lib
                    rm -rf target/railsApp*
                    rm -rf src
                &lt;/argument&gt;
              &lt;/arguments&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;exec&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
           &lt;!-- Here we optionally create the final war file containing our rails app using warbler,
                     doing a small cleanup of the files and folders maven created  --&gt;
            &lt;id&gt;create-final-war&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;executable&gt;/bin/sh&lt;/executable&gt;
              &lt;workingDirectory&gt;.&lt;/workingDirectory&gt;
              &lt;arguments&gt;
                &lt;argument&gt;-c&lt;/argument&gt;
                &lt;argument&gt;
                   rm -rf *.war tmp/war
                   jruby -S warble &amp;amp;&amp;amp; \
                   mv *.war target/railsApp.war
                &lt;/argument&gt;
              &lt;/arguments&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
              &lt;goal&gt;exec&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
     &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
Now from the command line we can just run mvn package and we&rsquo;re good to go.Maven will start to package the application as a war file. Since it&rsquo;s not a Java application we create the empty web.xml file in the compile phase, to fool maven. After it has copied all the dependencies into WEB-INF/lib the next packaging goals will make sure we copy them to our rails&rsquo; lib folder, also creating the final war file, ready for deployment.Note that once done, you can use a simple code snippet similar to this one as an initializer and load all dependencies:Dir.entries(&quot;#{RAILS_ROOT}/lib&quot;).sort.each do |entry|  if entry =~ /.jar$/    require entry  endendThen we can just use script/console, script/server and so on, as we normally would.Sorry for the long post, I tried to pack in as much as I could and I certainly hope it&rsquo;s useful to someone. Any doubts, comments and etc&hellip; just drop me a line. :)">
    <meta name="generator" content="Hugo 0.139.4">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.1a1e856c575c37c0a14fa63fe637fefcac5fc8a9e372c7d8de0184b5ab217407.css" >



    

    
      
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />


    

    

    
      <link rel="canonical" href="http://leonardoborges.com/writings/2009/07/01/jruby-on-rails-and-legacy-java-apps-managing-dependencies/">
    

    <meta property="og:url" content="http://leonardoborges.com/writings/2009/07/01/jruby-on-rails-and-legacy-java-apps-managing-dependencies/">
  <meta property="og:site_name" content="Leonardo Borges">
  <meta property="og:title" content="jruby on rails and legacy java apps managing dependencies">
  <meta property="og:description" content="The motivation for this post came from a couple of messages I&#39;ve seen on the jruby&#39;s google group and because I think it&#39;s pretty cool to share how we tackled this problem.
- A little bit of context
We, as a vast amount of people out there, have legacy Java code. A lot. In our case this legacy is pretty much crucial to our business. We can&#39;t just trash it and start from scratch. Bad idea.
On the other hand we do have new features to be built on top of it. But we wanted an easier way to develop this new stuff and decided for a JRuby on Rails solution, using it as a front-end to our existing services.
- What we decided to do
Our final rails project would make use of a specially created jar file containing our Java application. This Jar would also contain a public interface of the services we&#39;d have to interact with from rails.
As any Java application, ours depend on a number of external jar files that correspond to the various framewoks we usually have in place. e.g.: Hibernate, Spring, apache-commons ...
Which means we need to make our app&#39;s jar and all it&#39;s dependencies available in the JRuby classpath in order to use it.
Given we&#39;re using warbler to package our application as a war file, we just need to place all jars needed into our rails app&#39;s lib folder. Warbler then takes care of copying any jar files located in there into the war.
- The problem
So we needed a smart way to include all these dependencies into the project, and copy/paste isn&#39;t an option.
In the Java world we use Maven to manage our projects dependencies - and you should too. Because of that our approach involved turning our rails application into a Maven aware project.
Basically we needed a pom file that would declaratively list our java project as a dependency. From there on, Maven knows what the dependencies are and downloads them to your local repository.
Which leaves us with one more task. We need to put all these dependencies into our lib folder after maven has downloaded them.
Below you&#39;ll find the pom.xml file that we use to achieve this with inline comments explaining each bit:
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;!-- notice how we specify the packaging to be a war, that way, maven knows where to copy the jar files --&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;artifactId&gt;railsApp&lt;/artifactId&gt; &lt;name&gt;railsApp&lt;/name&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;artifactId&gt;java-legacy-app&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;railsApp&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;!-- This tasks only creates a basic structure expected by maven, so it can do its work --&gt; &lt;id&gt;create-mock-web-descriptor&lt;/id&gt; &lt;phase&gt;compile&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; mkdir -p src/main/webapp/WEB-INF touch src/main/webapp/WEB-INF/web.xml &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Now in the package phase we copy the jar files that maven put into the fake web app to our rails&#39; lib folder --&gt; &lt;id&gt;copy-needed-jars-into-lib&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -f lib/*.jar cp target/railsApp/WEB-INF/lib/*.jar lib rm -rf target/railsApp* rm -rf src &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Here we optionally create the final war file containing our rails app using warbler, doing a small cleanup of the files and folders maven created --&gt; &lt;id&gt;create-final-war&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -rf *.war tmp/war jruby -S warble &amp;amp;&amp;amp; \ mv *.war target/railsApp.war &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; Now from the command line we can just run mvn package and we’re good to go.
Maven will start to package the application as a war file. Since it’s not a Java application we create the empty web.xml file in the compile phase, to fool maven. After it has copied all the dependencies into WEB-INF/lib the next packaging goals will make sure we copy them to our rails’ lib folder, also creating the final war file, ready for deployment.
Note that once done, you can use a simple code snippet similar to this one as an initializer and load all dependencies:
Dir.entries(&#34;#{RAILS_ROOT}/lib&#34;).sort.each do |entry|
if entry =~ /.jar$/
require entry
end
end
Then we can just use script/console, script/server and so on, as we normally would.
Sorry for the long post, I tried to pack in as much as I could and I certainly hope it’s useful to someone. Any doubts, comments and etc… just drop me a line. :)">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writings">
    <meta property="article:published_time" content="2009-07-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2009-07-01T00:00:00+00:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="JRuby">
    <meta property="article:tag" content="Rails">

  <meta itemprop="name" content="jruby on rails and legacy java apps managing dependencies">
  <meta itemprop="description" content="The motivation for this post came from a couple of messages I&#39;ve seen on the jruby&#39;s google group and because I think it&#39;s pretty cool to share how we tackled this problem.
- A little bit of context
We, as a vast amount of people out there, have legacy Java code. A lot. In our case this legacy is pretty much crucial to our business. We can&#39;t just trash it and start from scratch. Bad idea.
On the other hand we do have new features to be built on top of it. But we wanted an easier way to develop this new stuff and decided for a JRuby on Rails solution, using it as a front-end to our existing services.
- What we decided to do
Our final rails project would make use of a specially created jar file containing our Java application. This Jar would also contain a public interface of the services we&#39;d have to interact with from rails.
As any Java application, ours depend on a number of external jar files that correspond to the various framewoks we usually have in place. e.g.: Hibernate, Spring, apache-commons ...
Which means we need to make our app&#39;s jar and all it&#39;s dependencies available in the JRuby classpath in order to use it.
Given we&#39;re using warbler to package our application as a war file, we just need to place all jars needed into our rails app&#39;s lib folder. Warbler then takes care of copying any jar files located in there into the war.
- The problem
So we needed a smart way to include all these dependencies into the project, and copy/paste isn&#39;t an option.
In the Java world we use Maven to manage our projects dependencies - and you should too. Because of that our approach involved turning our rails application into a Maven aware project.
Basically we needed a pom file that would declaratively list our java project as a dependency. From there on, Maven knows what the dependencies are and downloads them to your local repository.
Which leaves us with one more task. We need to put all these dependencies into our lib folder after maven has downloaded them.
Below you&#39;ll find the pom.xml file that we use to achieve this with inline comments explaining each bit:
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;!-- notice how we specify the packaging to be a war, that way, maven knows where to copy the jar files --&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;artifactId&gt;railsApp&lt;/artifactId&gt; &lt;name&gt;railsApp&lt;/name&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;artifactId&gt;java-legacy-app&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;railsApp&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;!-- This tasks only creates a basic structure expected by maven, so it can do its work --&gt; &lt;id&gt;create-mock-web-descriptor&lt;/id&gt; &lt;phase&gt;compile&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; mkdir -p src/main/webapp/WEB-INF touch src/main/webapp/WEB-INF/web.xml &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Now in the package phase we copy the jar files that maven put into the fake web app to our rails&#39; lib folder --&gt; &lt;id&gt;copy-needed-jars-into-lib&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -f lib/*.jar cp target/railsApp/WEB-INF/lib/*.jar lib rm -rf target/railsApp* rm -rf src &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Here we optionally create the final war file containing our rails app using warbler, doing a small cleanup of the files and folders maven created --&gt; &lt;id&gt;create-final-war&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -rf *.war tmp/war jruby -S warble &amp;amp;&amp;amp; \ mv *.war target/railsApp.war &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; Now from the command line we can just run mvn package and we’re good to go.
Maven will start to package the application as a war file. Since it’s not a Java application we create the empty web.xml file in the compile phase, to fool maven. After it has copied all the dependencies into WEB-INF/lib the next packaging goals will make sure we copy them to our rails’ lib folder, also creating the final war file, ready for deployment.
Note that once done, you can use a simple code snippet similar to this one as an initializer and load all dependencies:
Dir.entries(&#34;#{RAILS_ROOT}/lib&#34;).sort.each do |entry|
if entry =~ /.jar$/
require entry
end
end
Then we can just use script/console, script/server and so on, as we normally would.
Sorry for the long post, I tried to pack in as much as I could and I certainly hope it’s useful to someone. Any doubts, comments and etc… just drop me a line. :)">
  <meta itemprop="datePublished" content="2009-07-01T00:00:00+00:00">
  <meta itemprop="dateModified" content="2009-07-01T00:00:00+00:00">
  <meta itemprop="wordCount" content="741">
  <meta itemprop="keywords" content="Java,JRuby,Rails">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="jruby on rails and legacy java apps managing dependencies">
  <meta name="twitter:description" content="The motivation for this post came from a couple of messages I&#39;ve seen on the jruby&#39;s google group and because I think it&#39;s pretty cool to share how we tackled this problem.
- A little bit of context
We, as a vast amount of people out there, have legacy Java code. A lot. In our case this legacy is pretty much crucial to our business. We can&#39;t just trash it and start from scratch. Bad idea.
On the other hand we do have new features to be built on top of it. But we wanted an easier way to develop this new stuff and decided for a JRuby on Rails solution, using it as a front-end to our existing services.
- What we decided to do
Our final rails project would make use of a specially created jar file containing our Java application. This Jar would also contain a public interface of the services we&#39;d have to interact with from rails.
As any Java application, ours depend on a number of external jar files that correspond to the various framewoks we usually have in place. e.g.: Hibernate, Spring, apache-commons ...
Which means we need to make our app&#39;s jar and all it&#39;s dependencies available in the JRuby classpath in order to use it.
Given we&#39;re using warbler to package our application as a war file, we just need to place all jars needed into our rails app&#39;s lib folder. Warbler then takes care of copying any jar files located in there into the war.
- The problem
So we needed a smart way to include all these dependencies into the project, and copy/paste isn&#39;t an option.
In the Java world we use Maven to manage our projects dependencies - and you should too. Because of that our approach involved turning our rails application into a Maven aware project.
Basically we needed a pom file that would declaratively list our java project as a dependency. From there on, Maven knows what the dependencies are and downloads them to your local repository.
Which leaves us with one more task. We need to put all these dependencies into our lib folder after maven has downloaded them.
Below you&#39;ll find the pom.xml file that we use to achieve this with inline comments explaining each bit:
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;!-- notice how we specify the packaging to be a war, that way, maven knows where to copy the jar files --&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;artifactId&gt;railsApp&lt;/artifactId&gt; &lt;name&gt;railsApp&lt;/name&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.company&lt;/groupId&gt; &lt;artifactId&gt;java-legacy-app&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;finalName&gt;railsApp&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;!-- This tasks only creates a basic structure expected by maven, so it can do its work --&gt; &lt;id&gt;create-mock-web-descriptor&lt;/id&gt; &lt;phase&gt;compile&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; mkdir -p src/main/webapp/WEB-INF touch src/main/webapp/WEB-INF/web.xml &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Now in the package phase we copy the jar files that maven put into the fake web app to our rails&#39; lib folder --&gt; &lt;id&gt;copy-needed-jars-into-lib&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -f lib/*.jar cp target/railsApp/WEB-INF/lib/*.jar lib rm -rf target/railsApp* rm -rf src &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;!-- Here we optionally create the final war file containing our rails app using warbler, doing a small cleanup of the files and folders maven created --&gt; &lt;id&gt;create-final-war&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;configuration&gt; &lt;executable&gt;/bin/sh&lt;/executable&gt; &lt;workingDirectory&gt;.&lt;/workingDirectory&gt; &lt;arguments&gt; &lt;argument&gt;-c&lt;/argument&gt; &lt;argument&gt; rm -rf *.war tmp/war jruby -S warble &amp;amp;&amp;amp; \ mv *.war target/railsApp.war &lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; Now from the command line we can just run mvn package and we’re good to go.
Maven will start to package the application as a war file. Since it’s not a Java application we create the empty web.xml file in the compile phase, to fool maven. After it has copied all the dependencies into WEB-INF/lib the next packaging goals will make sure we copy them to our rails’ lib folder, also creating the final war file, ready for deployment.
Note that once done, you can use a simple code snippet similar to this one as an initializer and load all dependencies:
Dir.entries(&#34;#{RAILS_ROOT}/lib&#34;).sort.each do |entry|
if entry =~ /.jar$/
require entry
end
end
Then we can just use script/console, script/server and so on, as we normally would.
Sorry for the long post, I tried to pack in as much as I could and I certainly hope it’s useful to someone. Any doubts, comments and etc… just drop me a line. :)">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

<header>
    <div class="bg-black">
        <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Leonardo Borges
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/books/" title="Books page">
              Books
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://leonardoborges.substack.com/p/leadership-coaching" title="Coaching page">
              Coaching
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://leonardoborges.substack.com/" title="Newsletter page">
              Newsletter
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"><a href="https://github.com/theleoborges/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a><a href="https://twitter.com/theleoborges" target="_blank" rel="noopener"
        class="ananke-social-link link-transition twitter link dib z-999 pt3 pt0-l mr1"
        title="follow on Twitter - Opens in a new window"
        aria-label="follow on Twitter - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
            
          </span></a><a href="http://linkedin.com/in/theleoborges" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>

    </div>
  </div>
</nav>

    </div>
    
</header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Writings
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">jruby on rails and legacy java apps managing dependencies</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2009-07-01T00:00:00Z">July 1, 2009</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>
The motivation for this post came from a couple of messages I've seen on the jruby's google group and because I think it's pretty cool to share how we tackled this problem.<br><br><strong>- A little bit of context</strong><br><br>We, as a vast amount of people out there, have legacy Java code. A lot. In our case this legacy is pretty much crucial to our business. We can't just trash it and start from scratch. Bad idea.<br><br>On the other hand we do have new features to be built on top of it. But we wanted an easier way to develop this new stuff and decided for a JRuby on Rails solution, using it as a front-end to our existing services.<br><br><strong>- What we decided to do</strong><br><br>Our final rails project would make use of a specially created jar file containing our Java application. This Jar would also contain a public interface of the services we'd have to interact with from rails.<br><br>As any Java application, ours depend on a number of external jar files that correspond to the various framewoks we usually have in place. e.g.: Hibernate, Spring, apache-commons ...<br><br>Which means we need to make our app's jar and all it's dependencies available in the JRuby classpath in order to use it.<br><br>Given we're using warbler to package our application as a war file, we just need to place all jars needed into our rails app's lib folder. Warbler then takes care of copying any jar files located in there into the war.<br><br><strong>- The problem</strong><br><br>So we needed a smart way to include all these dependencies into the project, and copy/paste isn't an option.<br><br>In the Java world we use <a href="http://maven.apache.org/">Maven</a> to manage our projects dependencies - and you should too. Because of that our approach involved turning our rails application into a Maven aware project.<br><br>Basically we needed a <a href="http://maven.apache.org/pom.html">pom file</a> that would declaratively list our java project as a dependency. From there on, Maven knows what the dependencies are and downloads them to your local repository.<br><br>Which leaves us with one more task. We need to put all these dependencies into our lib folder after maven has downloaded them.<br><br>Below you'll find the pom.xml file that we use to achieve this with inline comments explaining each bit:<br>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>com.company<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- notice how we specify the packaging to be a war,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">          that way, maven knows where to copy the jar files --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;packaging&gt;</span>war<span style="color:#f92672">&lt;/packaging&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>railsApp<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>railsApp<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>com.company<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>java-legacy-app<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>compile<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;finalName&gt;</span>railsApp<span style="color:#f92672">&lt;/finalName&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;groupId&gt;</span>org.codehaus.mojo<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;artifactId&gt;</span>exec-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- This tasks only creates a basic structure expected by maven,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    so it can do its work --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;id&gt;</span>create-mock-web-descriptor<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;phase&gt;</span>compile<span style="color:#f92672">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;executable&gt;</span>/bin/sh<span style="color:#f92672">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;workingDirectory&gt;</span>.<span style="color:#f92672">&lt;/workingDirectory&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>-c<span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>
</span></span><span style="display:flex;"><span>                    mkdir -p src/main/webapp/WEB-INF
</span></span><span style="display:flex;"><span>                    touch    src/main/webapp/WEB-INF/web.xml
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;goal&gt;</span>exec<span style="color:#f92672">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">&lt;!-- Now in the package phase we copy the jar files
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    that maven put into the fake web app to our rails&#39; lib folder --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;id&gt;</span>copy-needed-jars-into-lib<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;phase&gt;</span>package<span style="color:#f92672">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;executable&gt;</span>/bin/sh<span style="color:#f92672">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;workingDirectory&gt;</span>.<span style="color:#f92672">&lt;/workingDirectory&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>-c<span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>
</span></span><span style="display:flex;"><span>                    rm -f lib/*.jar
</span></span><span style="display:flex;"><span>                    cp target/railsApp/WEB-INF/lib/*.jar lib
</span></span><span style="display:flex;"><span>                    rm -rf target/railsApp*
</span></span><span style="display:flex;"><span>                    rm -rf src
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;goal&gt;</span>exec<span style="color:#f92672">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#75715e">&lt;!-- Here we optionally create the final war file containing our rails app using warbler,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                     doing a small cleanup of the files and folders maven created  --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;id&gt;</span>create-final-war<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;phase&gt;</span>package<span style="color:#f92672">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;executable&gt;</span>/bin/sh<span style="color:#f92672">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;workingDirectory&gt;</span>.<span style="color:#f92672">&lt;/workingDirectory&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>-c<span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;argument&gt;</span>
</span></span><span style="display:flex;"><span>                   rm -rf *.war tmp/war
</span></span><span style="display:flex;"><span>                   jruby -S warble &amp;amp;&amp;amp; \
</span></span><span style="display:flex;"><span>                   mv *.war target/railsApp.war
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;goal&gt;</span>exec<span style="color:#f92672">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/project&gt;</span>
</span></span></code></pre></div><p><br><br>Now from the command line we can just run <em>mvn package</em> and we&rsquo;re good to go.<br><br>Maven will start to package the application as a war file. Since it&rsquo;s not a Java application we create the empty web.xml file in the compile phase, to fool maven. <br><br><br>After it has copied all the dependencies into WEB-INF/lib the next packaging goals will make sure we copy them to our rails&rsquo; lib folder, also creating the final war file, ready for deployment.<br><br><br>Note that once done, you can use a simple code snippet similar to this one as an initializer and load all dependencies:<br><pre lang="ruby"><br>Dir.entries(&quot;#{RAILS_ROOT}/lib&quot;).sort.each do |entry|<br>  if entry =~ /.jar$/<br>    require entry<br>  end<br>end<br></pre><br><br>Then we can just use script/console, script/server and so on, as we normally would.<br><br>Sorry for the long post, I tried to pack in as much as I could and I certainly hope it&rsquo;s useful to someone. Any doubts, comments and etc&hellip; just drop me a line. :)</p>
</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/java/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Java</a>
   </li>
  
   <li class="list di">
     <a href="/tags/jruby/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">JRuby</a>
   </li>
  
   <li class="list di">
     <a href="/tags/rails/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Rails</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
        <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "leonardoborges" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/writings/2009/04/10/jruby-on-rails-and-google-app-engine/">jruby on rails and google app engine</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/06/22/google-io-thoughtworks-on-gae/">google io thoughtworks on gae</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/06/14/helping-the-jruby-effort-debugging-the-source/">helping the jruby effort debugging the source</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/05/29/railswaycon-jruby-internals-by-ola-bini/">railswaycon jruby internals by ola bini</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/05/05/rcov-jruby-and-rcov_plugin/">rcov jruby and rcov_plugin</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/04/07/jruby-db2-xquery-bug/">jruby db2 xquery bug</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/04/04/qcon-2008-slides-available/">qcon 2008 slides available</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/05/16/rails-readable-test-names-run-individual-tests-from-the-console/">rails readable test names run individual tests from the console</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/03/17/final-classes-are-evil/">final classes are evil</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2009/02/01/eclipse-tip-debugging-non-wtp-projects/">eclipse tip debugging non wtp projects</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/11/20/rails-performance-scripts-profiler-benchmarker/">rails performance scripts profiler benchmarker</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/10/08/dont-use-rexml-i-mean-it/">dont use rexml i mean it</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/09/09/railsconf-europe-2008-impressions-and-highlights/">railsconf europe 2008 impressions and highlights</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/08/30/railsconf-europe-2008-heading-to-berlin/">railsconf europe 2008 heading to berlin</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/writings/2008/08/28/mac-os-x-getting-mysql-and-rails-to-work/">mac os x getting mysql and rails to work</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://leonardoborges.com/" >
    &copy;  Leonardo Borges 2025 
  </a>
    <div><div class="ananke-socials"><a href="https://github.com/theleoborges/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a><a href="https://twitter.com/theleoborges" target="_blank" rel="noopener"
        class="ananke-social-link link-transition twitter link dib z-999 pt3 pt0-l mr1"
        title="follow on Twitter - Opens in a new window"
        aria-label="follow on Twitter - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
            
          </span></a><a href="http://linkedin.com/in/theleoborges" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a></div>
</div>
  </div>
</footer>

  </body>
</html>
